apiVersion: v1
kind: ConfigMap
metadata:
  name: [[${METADATA_NAME}]]
data:
  vector.yaml: |
    sources:
      mongod_logs:
        type: file
        include:
          - "/data/db/mongod.log"
    
    transforms:
      enriched_mongod_logs:
        type: remap
        inputs:
          - mongod_logs
        source: |-
          .onyxdb_project = "[[${ONYXDB_PROJECT}]]"
          .onyxdb_cluster = "[[${ONYXDB_CLUSTER}]]"

    sinks:
      vlogs:
        inputs:
          - enriched_mongod_logs
        type: http
        uri: [[${VLOGS_BASE_URL}]]/insert/jsonline?_stream_fields=host,container_name&_msg_field=message&_time_field=timestamp
        compression: gzip
        encoding:
          codec: json
        framing:
          method: newline_delimited
        healthcheck:
          enabled: true
